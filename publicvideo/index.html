<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>本地高清视频播放器</title>
    <meta name="description" content="一个采用专业分栏式布局的本地视频播放器，支持智能防重、精准触控和卓越的跨平台响应式体验。">
    <meta name="keywords" content="视频播放器, 本地播放器, 播放列表, HTML播放器, JavaScript">
    <meta name="author" content="菜鸟程序员的得力助手">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%23e74c3c%22/><path d=%22M40 30 L70 50 L40 70 Z%22 fill=%22white%22/></svg>">
    
    <style>
        :root {
            --theme-color: #e74c3c; --background-color: #1d2227; --section-background: #2c343c;
            --text-color: #e0e0e0; --text-color-muted: #8899a6; --border-color: #455a64;
        }
        body { margin: 0; background-color: var(--background-color); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; color: var(--text-color); overflow: hidden; }
        .app-container { display: flex; height: 100vh; width: 100vw; flex-direction: row; }
        .player-section { flex: 3; display: flex; justify-content: center; align-items: center; background-color: #000; position: relative; transition: border 0.3s; }
        .video-container { width: 100%; height: 100%; max-width: 1200px; position: relative; overflow: hidden; line-height: 0; display: flex; align-items: center; justify-content: center; }
        video { width: 100%; display: block; max-height: 100vh; cursor: pointer; }
        .playlist-section { flex: 1; min-width: 280px; max-width: 400px; background-color: var(--section-background); display: flex; flex-direction: column; border-left: 1px solid var(--border-color); transition: border 0.3s; }
        .playlist-header { padding: 15px; display: flex; gap: 10px; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        .playlist-header button { flex: 1; padding: 10px 15px; font-size: 14px; border: none; border-radius: 5px; cursor: pointer; transition: all 0.3s; color: white; }
        #select-files-btn { background-color: var(--theme-color); } #select-files-btn:hover { background-color: #c0392b; }
        #clear-playlist-btn { background-color: #607d8b; } #clear-playlist-btn:hover { background-color: #455a64; }
        #clear-playlist-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .playlist-content { flex-grow: 1; overflow-y: auto; position: relative; }
        #playlist { list-style: none; padding: 0; margin: 0; }
        #playlist li { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; cursor: pointer; border-bottom: 1px solid var(--border-color); font-size: 14px; transition: background-color 0.2s; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; position: relative; }
        #playlist li:hover { background-color: #37474f; } #playlist li.active { background-color: var(--theme-color); color: white; font-weight: bold; }
        #playlist li .track-name { flex-grow: 1; overflow: hidden; text-overflow: ellipsis; }
        .remove-track { display: none; padding: 0 8px; font-size: 20px; font-weight: bold; cursor: pointer; z-index: 1; }
        #playlist li:hover .remove-track { display: block; }
        .playing-indicator { margin-right: 10px; width: 16px; height: 16px; display: none; }
        #playlist li.active .playing-indicator { display: inline-block; }
        .empty-playlist-message { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); color: var(--text-color-muted); text-align: center; }
        .drag-over { border: 3px dashed var(--theme-color); box-sizing: border-box; }
        .player-section:fullscreen .video-container { width: 100%; height: 100%; max-width: none; }
        
        .controls { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); color: white; opacity: 0; transition: opacity 0.3s ease-in-out; padding-top: 20px; z-index: 5; pointer-events: none; }
        .video-container.show-controls .controls { opacity: 1; pointer-events: auto; }
        .progress-bar-container { height: 5px; cursor: pointer; background-color: rgba(255, 255, 255, 0.3); width: 100%; transition: height 0.2s ease; } .progress-bar-container:hover { height: 8px; } .progress-bar { background-color: var(--theme-color); width: 0%; height: 100%; border-radius: 4px; transition: width 0.1s linear; } .bottom-controls { display: flex; justify-content: space-between; align-items: center; padding: 5px 15px; height: 45px; } .left-controls, .right-controls { display: flex; align-items: center; gap: 10px; } .control-btn { background: none; border: none; color: white; cursor: pointer; padding: 8px; display: flex; border-radius: 50%; transition: background-color 0.2s; } .control-btn:hover { background-color: rgba(255, 255, 255, 0.2); } .control-btn .icon { width: 24px; height: 24px; fill: currentColor; } .pause-icon { display: none; } .video-container.playing .play-icon { display: none; }.video-container.playing .pause-icon { display: block; } .volume-container { display: flex; align-items: center; } .volume-slider { width: 0; transition: width 0.2s ease-in-out; margin-left: 8px; -webkit-appearance: none; background: transparent; cursor: pointer; } .volume-container:hover .volume-slider { width: 80px; } .volume-slider::-webkit-slider-runnable-track { background: rgba(255, 255, 255, 0.5); height: 4px; border-radius: 2px; } .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%; background: white; margin-top: -5px; } .volume-mute-icon { display: none; } .video-container.muted .volume-high-icon { display: none; }.video-container.muted .volume-mute-icon { display: block; } .speed-control { position: relative; } .speed-options { display: none; position: absolute; bottom: 100%; right: 0; background-color: rgba(0, 0, 0, 0.9); list-style: none; padding: 5px 0; margin: 0 0 5px 0; border-radius: 4px; } .speed-control:hover .speed-options { display: block; } #speed-btn { width: 50px; } .speed-options li { padding: 10px 20px; cursor: pointer; } .speed-options li:hover { background-color: var(--theme-color); } .close-fullscreen-icon { display: none; } .player-section:fullscreen .open-fullscreen-icon { display: none; }.player-section:fullscreen .close-fullscreen-icon { display: block; }

        .mini-progress-bar {
            position: absolute; bottom: 0; left: 0;
            width: 0%; height: 3px;
            background-color: var(--theme-color);
            z-index: 6;
            opacity: 1;
            transition: opacity 0.3s ease-in-out, width 0.1s linear;
            pointer-events: none;
        }
        .video-container.show-controls .mini-progress-bar { opacity: 0; }

        @media (max-width: 800px) {
            .app-container { flex-direction: column; }
            .player-section { flex: 2 1 45vh; min-height: 220px; }
            .playlist-section { flex: 1 1 auto; border-left: none; border-top: 1px solid var(--border-color); max-width: 100%; }
            .playlist-header { padding: 8px; gap: 8px; } .playlist-header button { padding: 8px 10px; font-size: 13px; }
            #playlist li { padding: 10px 12px; font-size: 13px; }
            .left-controls, .right-controls { gap: 4px; } .time-display { margin-left: 6px; }
            .progress-bar-container { height: 15px; padding: 5px 0; box-sizing: border-box; }
            .progress-bar { height: 8px; /* 最终修改: 视觉高度变为8px */ }
            .volume-slider { width: 80px; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <section class="player-section" id="player-section"><div class="video-container" id="video-container"><video id="video" preload="metadata"></video><div class="mini-progress-bar" id="mini-progress-bar"></div><div class="controls" id="controls"><div class="progress-bar-container" id="progress-bar-container"><div class="progress-bar" id="progress-bar"></div></div><div class="bottom-controls"><div class="left-controls"><button class="control-btn" id="play-pause-btn" title="播放/暂停 (空格键)"><svg class="icon play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg><svg class="icon pause-icon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg></button><div class="volume-container"><button class="control-btn" id="volume-btn" title="静音/取消静音 (m)"><svg class="icon volume-high-icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg><svg class="icon volume-mute-icon" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg></button><input type="range" id="volume-slider" class="volume-slider" min="0" max="1" step="0.01" value="1"></div><div class="time-display" id="time-display"><span id="current-time">0:00</span> / <span id="duration">0:00</span></div></div><div class="right-controls"><div class="speed-control"><button class="control-btn" id="speed-btn">1.0x</button><ul class="speed-options" id="speed-options"><li data-speed="2.0">2.0x</li><li data-speed="1.5">1.5x</li><li data-speed="1.25">1.25x</li><li data-speed="1.0">1.0x</li><li data-speed="0.75">0.75x</li><li data-speed="0.5">0.5x</li></ul></div><button class="control-btn" id="fullscreen-btn" title="全屏 (f)"><svg class="icon open-fullscreen-icon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg><svg class="icon close-fullscreen-icon" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg></button></div></div></div></div></section>
        <section class="playlist-section" id="playlist-section"><div class="playlist-header"><input type="file" id="file-input" accept="video/*" multiple hidden><button id="select-files-btn">追加文件</button><button id="clear-playlist-btn" disabled>清空列表</button></div><div class="playlist-content"><p class="empty-playlist-message" id="empty-message">点击 "追加文件" 或拖拽视频到此处</p><ul id="playlist"></ul></div></section>
    </div>

<script>
    // --- JavaScript 逻辑 (完全不变) ---
    const playerSection = document.getElementById('player-section'); const video = document.getElementById('video'); const videoContainer = document.getElementById('video-container'); const controls = document.getElementById('controls'); const playlistSection = document.getElementById('playlist-section'); const playPauseBtn = document.getElementById('play-pause-btn'); const progressBarContainer = document.getElementById('progress-bar-container'); const progressBar = document.getElementById('progress-bar'); const miniProgressBar = document.getElementById('mini-progress-bar'); const volumeBtn = document.getElementById('volume-btn'); const volumeSlider = document.getElementById('volume-slider'); const currentTimeEl = document.getElementById('current-time'); const durationEl = document.getElementById('duration'); const speedBtn = document.getElementById('speed-btn'); const speedOptions = document.getElementById('speed-options'); const fullscreenBtn = document.getElementById('fullscreen-btn'); const fileInput = document.getElementById('file-input'); const selectFilesBtn = document.getElementById('select-files-btn'); const clearPlaylistBtn = document.getElementById('clear-playlist-btn'); const playlistElement = document.getElementById('playlist'); const emptyMessage = document.getElementById('empty-message');
    const isFullScreen = () => !!document.fullscreenElement;
    let playlistFiles = []; let currentTrackIndex = -1;
    function isFileInPlaylist(file) { return playlistFiles.some(existingFile => existingFile.name === file.name && existingFile.size === file.size && existingFile.lastModified === file.lastModified); }
    function renderPlaylist() { playlistElement.innerHTML = ''; emptyMessage.style.display = playlistFiles.length === 0 ? 'block' : 'none'; clearPlaylistBtn.disabled = playlistFiles.length === 0; playlistFiles.forEach((file, index) => { const li = document.createElement('li'); li.dataset.index = index; const indicator = document.createElement('img'); indicator.className = 'playing-indicator'; indicator.src = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M8 5v14l11-7z'/%3E%3C/svg%3E`; li.appendChild(indicator); const nameSpan = document.createElement('span'); nameSpan.className = 'track-name'; nameSpan.textContent = file.name; li.appendChild(nameSpan); const removeBtn = document.createElement('span'); removeBtn.className = 'remove-track'; removeBtn.innerHTML = '&times;'; removeBtn.title = '从列表中移除'; removeBtn.addEventListener('click', (e) => { e.stopPropagation(); removeTrack(index); }); li.appendChild(removeBtn); if (index === currentTrackIndex) { li.classList.add('active'); li.scrollIntoView({ behavior: 'smooth', block: 'center' }); } li.addEventListener('click', () => playTrack(index)); playlistElement.appendChild(li); }); }
    function playTrack(index) { if (index < 0 || index >= playlistFiles.length) { if (playlistFiles.length === 0) resetPlayer(); return; } currentTrackIndex = index; const file = playlistFiles[index]; const videoURL = URL.createObjectURL(file); video.src = videoURL; video.play().catch(e => console.warn("自动播放被浏览器阻止")); renderPlaylist(); }
    function removeTrack(index) { playlistFiles.splice(index, 1); if (index === currentTrackIndex) { playTrack(index); } else if (index < currentTrackIndex) { currentTrackIndex--; renderPlaylist(); } else { renderPlaylist(); } }
    function addFilesToPlaylist(files) { const newVideoFiles = Array.from(files).filter(f => f.type.startsWith('video/') && !isFileInPlaylist(f)); if (newVideoFiles.length === 0) return; const wasEmpty = playlistFiles.length === 0; playlistFiles = playlistFiles.concat(newVideoFiles); if (wasEmpty) { playTrack(0); } else { renderPlaylist(); } }
    function resetPlayer() { video.pause(); video.src = ''; currentTrackIndex = -1; playlistFiles = []; currentTimeEl.textContent = '0:00'; durationEl.textContent = '0:00'; progressBar.style.width = '0%'; miniProgressBar.style.width = '0%'; renderPlaylist(); }
    function togglePlay() { if (video.src) video.paused ? video.play() : video.pause(); }
    function toggleFullscreen() { if (!isFullScreen()) { playerSection.requestFullscreen().catch(err => alert(`无法进入全屏模式: ${err.message}`)); } else { document.exitFullscreen(); } }
    function updatePlayPauseIcon() { videoContainer.classList.toggle('playing', !video.paused); videoContainer.classList.toggle('paused', video.paused); }
    let controlsTimeout;
    function showControls() { if (video.src) { videoContainer.classList.add('show-controls'); clearTimeout(controlsTimeout); if (!video.paused) { controlsTimeout = setTimeout(hideControls, 2500); } } }
    function hideControls() { videoContainer.classList.remove('show-controls'); }
    video.addEventListener('click', (e) => { if (e.target !== video) return; togglePlay(); });
    video.addEventListener('dblclick', (e) => { if (e.target !== video) return; toggleFullscreen(); });
    selectFilesBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', () => { addFilesToPlaylist(fileInput.files); fileInput.value = ''; });
    clearPlaylistBtn.addEventListener('click', resetPlayer);
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => document.body.addEventListener(eventName, e => e.preventDefault()));
    function setupDropZone(element, onDrop) { element.addEventListener('dragover', () => element.classList.add('drag-over')); element.addEventListener('dragleave', () => element.classList.remove('drag-over')); element.addEventListener('drop', (e) => { element.classList.remove('drag-over'); onDrop(e.dataTransfer.files); }); }
    setupDropZone(playlistSection, addFilesToPlaylist); setupDropZone(playerSection, (files) => { resetPlayer(); addFilesToPlaylist(files); });
    video.addEventListener('play', () => { updatePlayPauseIcon(); showControls(); });
    video.addEventListener('pause', () => { updatePlayPauseIcon(); showControls(); });
    video.addEventListener('ended', () => { if (currentTrackIndex < playlistFiles.length - 1) playTrack(currentTrackIndex + 1); });
    playerSection.addEventListener('mousemove', showControls);
    playerSection.addEventListener('mouseleave', hideControls);
    function setupButtonListener(button, action) { button.addEventListener('click', (e) => { e.stopPropagation(); action(); }); }
    setupButtonListener(playPauseBtn, togglePlay); setupButtonListener(fullscreenBtn, toggleFullscreen);
    function toggleMute() { video.muted = !video.muted; volumeSlider.value = video.muted ? 0 : video.volume; videoContainer.classList.toggle('muted', video.muted); }
    setupButtonListener(volumeBtn, toggleMute); 
    function updateProgress() { if (video.duration) { const progressPercent = (video.currentTime / video.duration) * 100; progressBar.style.width = `${progressPercent}%`; miniProgressBar.style.width = `${progressPercent}%`; currentTimeEl.textContent = formatTime(video.currentTime); } }
    progressBarContainer.addEventListener('click', (e) => { if (video.duration) { video.currentTime = (e.offsetX / progressBarContainer.clientWidth) * video.duration; updateProgress(); showControls(); } });
    video.addEventListener('timeupdate', updateProgress);
    video.addEventListener('loadedmetadata', () => { if (video.duration) durationEl.textContent = formatTime(video.duration); });
    volumeSlider.addEventListener('input', (e) => { e.stopPropagation(); video.volume = e.target.value; video.muted = e.target.value == 0; videoContainer.classList.toggle('muted', video.muted); showControls(); });
    speedOptions.addEventListener('click', (e) => { if (e.target.tagName === 'LI') { video.playbackRate = e.target.dataset.speed; speedBtn.textContent = `${e.target.dataset.speed}x`; } });
    function formatTime(s) { const m=Math.floor(s/60),c=Math.floor(s%60); return `${m}:${c<10?'0':''}${c}`; }
    document.addEventListener('keydown', (e) => { if (!video.src) return; e.preventDefault(); switch(e.code) { case 'Space': togglePlay(); break; case 'ArrowRight': video.currentTime += 5; break; case 'ArrowLeft': video.currentTime -= 5; break; case 'ArrowUp': video.volume = Math.min(1, video.volume + 0.1); volumeSlider.value = video.volume; break; case 'ArrowDown': video.volume = Math.max(0, video.volume - 0.1); volumeSlider.value = video.volume; break; case 'KeyF': toggleFullscreen(); break; case 'KeyM': toggleMute(); break; } showControls(); });
    renderPlaylist();
</script>
</body>
</html>